#!/bin/bash
set -e # remove allowance errors (and exit 1)
echo -e "todo: powscript should return error code\n\n"

printline(){
  cat | awk "{ print \"$*> \"\$0 }"
}

for file in test/*.bash; do 
  [[ -x $file ]] && $file | printline $file
done

./powscript --compile test/code-1.pow | printline "test/code-1.pow"
./powscript --compile test/compilation/strict-function-inclusion.pow | {
  included="$(grep -E "(map|on) \(\)")"
  { echo "$included" | grep "map"; } || exit 1
  { echo "$included" | grep "on" ; } && exit 1 || exit 0
} || exit 1

for file in test/*.pow; do 
  ./powscript $file | printline $file
done
for file in test/interactive/*.pow; do 
  ./powscript --interactive < $file | printline $file
done
echo 'OK'
exit 0
